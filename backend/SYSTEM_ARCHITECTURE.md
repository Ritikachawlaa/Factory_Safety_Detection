# ğŸ”§ System Architecture - Visual Summary

---

## Complete System Flow

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                        FACTORY AI SAAS - 4 MODULES                        â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

Frontend (Angular)              Backend (FastAPI)           ML Pipeline
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Dashboard     â”‚             â”‚   API Server     â”‚        â”‚  Inference       â”‚
â”‚ (localhost:4200)â”‚ â”€â”€â”€â”€POSTâ”€â”€â”€â†’â”‚ (localhost:8000) â”‚â”€â”€â”€â”€â”€â”€â”€â†’â”‚  Engine          â”‚
â”‚                 â”‚  /api/      â”‚                  â”‚        â”‚                  â”‚
â”‚ Shows:          â”‚  process    â”‚ - Health check   â”‚        â”‚ YOLOv8n          â”‚
â”‚ - Occupancy     â”‚             â”‚ - Diagnostics    â”‚        â”‚ AWS Rekognition  â”‚
â”‚ - Employees     â”‚             â”‚ - Frame process  â”‚        â”‚ EasyOCR          â”‚
â”‚ - Vehicles      â”‚ â†â”€â”€â”€JSONâ”€â”€â”€â”€â”‚ - Enrollment     â”‚â†â”€â”€â”€â”€â”€â”€â”€â”‚ Centroid Track   â”‚
â”‚ - Charts        â”‚   response  â”‚                  â”‚        â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚   Database     â”‚
                                â”‚  (SQLAlchemy)  â”‚
                                â”‚                â”‚
                                â”‚ PostgreSQL or  â”‚
                                â”‚    SQLite      â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Request/Response Flow (Single Frame)

```
HTTP Request (POST /api/process)
{
  "frame": "base64_jpeg_image"
}
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           UNIFIED INFERENCE ENGINE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Step 1: Decode Frame â†’ OpenCV Image                       â”‚
â”‚  Step 2: YOLOv8 Detection â†’ People + Vehicles + Track IDs  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ MODULE 1 & 3: IDENTITY & ATTENDANCE                â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ For each person detected:                           â”‚   â”‚
â”‚  â”‚  1. Crop face region                               â”‚   â”‚
â”‚  â”‚  2. Check known_faces cache[track_id]              â”‚   â”‚
â”‚  â”‚     â”œâ”€ HIT: Return cached name (cost: $0)         â”‚   â”‚
â”‚  â”‚     â””â”€ MISS: Query AWS Rekognition (cost: $0.001) â”‚   â”‚
â”‚  â”‚  3. Log to attendance_records table                â”‚   â”‚
â”‚  â”‚  4. Return: {track_id, name, confidence}          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ MODULE 2: VEHICLE & ANPR                            â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ For each vehicle detected:                          â”‚   â”‚
â”‚  â”‚  1. Crop bounding box                              â”‚   â”‚
â”‚  â”‚  2. Run EasyOCR on plate region                    â”‚   â”‚
â”‚  â”‚  3. Extract plate number (e.g., KA01AB1234)       â”‚   â”‚
â”‚  â”‚  4. Check whitelist/blacklist                      â”‚   â”‚
â”‚  â”‚  5. Log to vehicle_logs table                      â”‚   â”‚
â”‚  â”‚  6. Return: {track_id, type, plate}               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ MODULE 4: OCCUPANCY & COUNTING                      â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ For each person:                                    â”‚   â”‚
â”‚  â”‚  1. Get centroid position (cx, cy)                 â”‚   â”‚
â”‚  â”‚  2. Get previous position from state               â”‚   â”‚
â”‚  â”‚  3. Check if crossed line at y=400                 â”‚   â”‚
â”‚  â”‚     â”œâ”€ ENTRY: y < 400 â†’ y >= 400                 â”‚   â”‚
â”‚  â”‚     â””â”€ EXIT: y >= 400 â†’ y < 400                  â”‚   â”‚
â”‚  â”‚  4. Update occupancy counter                       â”‚   â”‚
â”‚  â”‚  5. Log to occupancy_logs table                    â”‚   â”‚
â”‚  â”‚  6. Return: {occupancy, entries, exits}           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  Step 3: Log to system_metrics table                       â”‚
â”‚  Step 4: Build JSON response                              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
HTTP Response (application/json)
{
  "success": true,
  "frame_id": 123,
  "timestamp": "2025-12-20T14:30:45.123Z",
  
  "occupancy": 42,
  "entries": 150,
  "exits": 108,
  "entries_this_frame": 2,
  "exits_this_frame": 1,
  
  "faces_recognized": [
    {
      "track_id": 1,
      "name": "John Doe",
      "confidence": 95.5,
      "source": "aws"
    }
  ],
  
  "vehicles_detected": [
    {
      "track_id": 2,
      "type": "car",
      "plate": "KA01AB1234",
      "confidence": 0.87
    }
  ],
  
  "people_count": 5,
  "vehicle_count": 2,
  "processing_time_ms": 145.32
}
```

---

## File Dependencies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend (Angular)                                         â”‚
â”‚  http requests to /api/process                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ main_integration.â”‚
            â”‚ py (FastAPI)     â”‚
            â”‚                  â”‚
            â”‚ POST /api/processâ”œâ”€â”€â”
            â”‚ GET /api/health  â”‚  â”‚
            â”‚ GET /api/         â”‚  â”‚
            â”‚ diagnostic       â”‚  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                     â”‚            â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
         â”‚ unified_inference_   â”‚ â”‚
         â”‚ engine.py            â”‚ â”‚
         â”‚                      â”‚ â”‚
         â”‚ InferencePipelineâ”€â”€â” â”‚ â”‚
         â”‚ class              â”‚ â”‚ â”‚
         â”‚ (wrapper)          â”‚ â”‚ â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
                     â”‚          â”‚ â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
         â”‚ unified_inference.py â”‚â”‚ â”‚
         â”‚                      â”‚â”‚ â”‚
         â”‚ YOLODetector         â”‚â”‚ â”‚
         â”‚ â”œâ”€ ultralytics YOLO  â”‚â”‚ â”‚
         â”‚                      â”‚â”‚ â”‚
         â”‚ AWSFaceRecognition   â”‚â”‚ â”‚
         â”‚ â”œâ”€ boto3 AWS         â”‚â”‚ â”‚
         â”‚                      â”‚â”‚ â”‚
         â”‚ PlateOCR             â”‚â”‚ â”‚
         â”‚ â”œâ”€ easyocr           â”‚â”‚ â”‚
         â”‚                      â”‚â”‚ â”‚
         â”‚ StatefulTracker      â”‚â”‚ â”‚
         â”‚ â”œâ”€ known_faces dict  â”‚â”‚ â”‚
         â”‚ â”œâ”€ previous_centroidsâ”‚â”‚ â”‚
         â”‚                      â”‚â”‚ â”‚
         â”‚ UnifiedInferenceEngine
         â”‚                      â”‚â”‚ â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
                     â”‚           â”‚ â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”˜
         â”‚
         â”‚ database_models.py
         â”‚ â”œâ”€ Employee
         â”‚ â”œâ”€ AttendanceRecord
         â”‚ â”œâ”€ Vehicle
         â”‚ â”œâ”€ VehicleLog
         â”‚ â”œâ”€ OccupancyLog
         â”‚ â”œâ”€ SystemMetric
         â”‚ â””â”€ SQLAlchemy ORM
         â”‚
         â””â”€â”€â†’ Database
              (PostgreSQL or SQLite)
```

---

## Module-by-Module Breakdown

### Module 1 & 3: Identity & Attendance

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ YOLO Detection                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Input:  Video frame (640Ã—480)                       â”‚
â”‚ Model:  yolov8n.pt (nano - 4.3MB)                  â”‚
â”‚ Output: [People] with track_ids + bboxes            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ For each person:    â”‚
        â”‚ Crop face region    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Face Cache Check    â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ HIT (90%)â”‚ MISS(10%)â”‚
        â”‚          â”‚          â”‚
        â”‚ Return   â”‚ AWS      â”‚
        â”‚ cached   â”‚ Rekognition
        â”‚ name     â”‚          â”‚
        â”‚ $0       â”‚ $0.001   â”‚
        â”‚ 1ms      â”‚ 150ms    â”‚
        â”‚          â”‚          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
            â”‚ Log to DB  â”‚
            â”‚ -employee_ â”‚
            â”‚  id        â”‚
            â”‚ -timestamp â”‚
            â”‚ -confidence
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Module 2: Vehicle & ANPR

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ YOLO Detection                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Input:  Video frame (640Ã—480)                       â”‚
â”‚ Classes: car(2), truck(7), bus(5), motorcycle(3)   â”‚
â”‚ Output: [Vehicles] with bboxes                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ For each vehicle:   â”‚
        â”‚ Crop plate region   â”‚
        â”‚ (bottom 20% of box) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ EasyOCR             â”‚
        â”‚ (local, free)       â”‚
        â”‚                     â”‚
        â”‚ Read text from      â”‚
        â”‚ plate image         â”‚
        â”‚                     â”‚
        â”‚ Cost: $0            â”‚
        â”‚ Time: 75ms          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
            â”‚ Log to DB  â”‚
            â”‚ -plate_id  â”‚
            â”‚ -timestamp â”‚
            â”‚ -status    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Module 4: Occupancy & Counting

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ YOLO Detection                                       â”‚
â”‚ Output: [People] with centroids (cx, cy)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ For each person:        â”‚
        â”‚ Get current centroid    â”‚
        â”‚ Get previous position   â”‚
        â”‚ (from state dict)       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Line Crossing Check         â”‚
    â”‚ LINE_Y = 400                â”‚
    â”‚                             â”‚
    â”‚ if prev_y â‰¤ 400 < cur_y:   â”‚
    â”‚    â†“ ENTRY (down) â†“        â”‚
    â”‚    occupancy += 1           â”‚
    â”‚    entries += 1             â”‚
    â”‚                             â”‚
    â”‚ elif prev_y > 400 â‰¥ cur_y: â”‚
    â”‚    â†‘ EXIT (up) â†‘           â”‚
    â”‚    occupancy -= 1           â”‚
    â”‚    exits += 1               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
        â”‚ Update Stateâ”‚
        â”‚ previous_   â”‚
        â”‚ centroids   â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
        â”‚ Log to DB   â”‚
        â”‚ -occupancy  â”‚
        â”‚ -timestamp  â”‚
        â”‚ -entries    â”‚
        â”‚ -exits      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Employee      â”‚  â”‚ AttendanceRecord â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)          â”‚  â”‚ id (PK)          â”‚
â”‚ employee_id      â”‚  â”‚ employee_id (FK) â”‚
â”‚ name             â”‚  â”‚ check_in_time    â”‚
â”‚ shift_start      â”‚  â”‚ check_out_time   â”‚
â”‚ shift_end        â”‚  â”‚ status           â”‚
â”‚ aws_face_id      â”‚  â”‚ aws_confidence   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ track_id         â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Vehicle      â”‚  â”‚   VehicleLog     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)          â”‚  â”‚ id (PK)          â”‚
â”‚ plate_number     â”‚  â”‚ track_id         â”‚
â”‚ vehicle_type     â”‚  â”‚ plate_number     â”‚
â”‚ status           â”‚  â”‚ vehicle_type     â”‚
â”‚ whitelist        â”‚  â”‚ entry_time       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ exit_time        â”‚
                      â”‚ ocr_confidence   â”‚
                      â”‚ status           â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OccupancyLog    â”‚  â”‚ SystemMetric     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)          â”‚  â”‚ id (PK)          â”‚
â”‚ camera_id        â”‚  â”‚ frame_id         â”‚
â”‚ current_occupancyâ”‚  â”‚ processing_ms    â”‚
â”‚ entries_count    â”‚  â”‚ aws_calls        â”‚
â”‚ exits_count      â”‚  â”‚ aws_cost_est     â”‚
â”‚ timestamp        â”‚  â”‚ cache_hits       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ timestamp        â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Performance Characteristics

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PROCESSING TIME BREAKDOWN                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚ Decode Base64         â–ˆâ–ˆâ–ˆâ–ˆ                 â”‚
â”‚ YOLOv8 inference      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ        â”‚
â”‚ Face cache hit        â–ˆ                     â”‚
â”‚ AWS Rekognition       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚
â”‚ EasyOCR plate         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ           â”‚
â”‚ Line crossing         â–ˆ                     â”‚
â”‚ Database logging      â–ˆâ–ˆâ–ˆâ–ˆ                  â”‚
â”‚                                             â”‚
â”‚ Total (cache):        ~50-100ms  (10 FPS)  â”‚
â”‚ Total (AWS):          ~250ms     (4 FPS)   â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AWS Caching Impact:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Without cache:  $756/month                  â”‚
â”‚ With cache:     $75.60/month                â”‚
â”‚ SAVINGS:        $680/month (90%!)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IN-MEMORY STATE (Maintained by Engine)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ known_faces Dictionary:                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ {                                   â”‚ â”‚
â”‚ â”‚   1: {                              â”‚ â”‚
â”‚ â”‚     'name': 'John Doe',             â”‚ â”‚
â”‚ â”‚     'confidence': 95.5,             â”‚ â”‚
â”‚ â”‚     'expires_at': datetime+10min    â”‚ â”‚
â”‚ â”‚   },                                â”‚ â”‚
â”‚ â”‚   2: { ... },                       â”‚ â”‚
â”‚ â”‚   ...                               â”‚ â”‚
â”‚ â”‚ }                                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ previous_centroids Dictionary:          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ {                                   â”‚ â”‚
â”‚ â”‚   1: (640, 300),  # John Doe        â”‚ â”‚
â”‚ â”‚   2: (500, 450),  # Jane Smith      â”‚ â”‚
â”‚ â”‚   3: (800, 200)   # Unknown         â”‚ â”‚
â”‚ â”‚ }                                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ Occupancy Counters:                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ {                                   â”‚ â”‚
â”‚ â”‚   'occupancy_current': 42,          â”‚ â”‚
â”‚ â”‚   'entry_count': 150,               â”‚ â”‚
â”‚ â”‚   'exit_count': 108                 â”‚ â”‚
â”‚ â”‚ }                                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Cost Breakdown (Per Month)

```
Scenario: Factory with 1 camera, 7 FPS, 10 hours/day

Daily Frames:      7 Ã— 3600 Ã— 10 = 252,000 frames
Monthly Frames:    252,000 Ã— 30 = 7,560,000 frames

WITHOUT Caching:
â”œâ”€ Person detection rate: 10%
â”œâ”€ Total detections: 756,000/month
â”œâ”€ AWS cost/detection: $0.001
â””â”€ Total cost: $756/month âŒ

WITH 90% Cache Hit:
â”œâ”€ New detections (10% miss): 75,600/month
â”œâ”€ AWS cost/detection: $0.001
â””â”€ Total cost: $75.60/month âœ…

Other Costs:
â”œâ”€ EasyOCR: $0 (local)
â”œâ”€ Database: $0 (SQLite) or ~$10-20 (PostgreSQL)
â”œâ”€ Server: $5-50 (depending on deployment)
â””â”€ TOTAL: ~$75-140/month (vs $756+ without cache)

SAVINGS: 80-90% of AWS costs!
```

---

## Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PRODUCTION DEPLOYMENT            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Docker Container                   â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚ â”‚ Python 3.9 + Dependencies    â”‚  â”‚ â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ â”‚
â”‚  â”‚ â”‚ - ultralytics (YOLOv8)       â”‚  â”‚ â”‚
â”‚  â”‚ â”‚ - boto3 (AWS)                â”‚  â”‚ â”‚
â”‚  â”‚ â”‚ - easyocr                    â”‚  â”‚ â”‚
â”‚  â”‚ â”‚ - fastapi + uvicorn          â”‚  â”‚ â”‚
â”‚  â”‚ â”‚ - sqlalchemy                 â”‚  â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚ â”‚ FastAPI Application          â”‚  â”‚ â”‚
â”‚  â”‚ â”‚ Port: 8000                   â”‚  â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚    â–¼             â–¼                      â”‚
â”‚  AWS         PostgreSQL                 â”‚
â”‚ (Rekognition) (Database)                â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Load Balancer (for multi-camera)
    â”‚
    â”œâ”€ Camera 1 â†’ /api/process
    â”œâ”€ Camera 2 â†’ /api/process
    â””â”€ Camera N â†’ /api/process
```

---

**Complete system with all 4 modules, ready for production!**

