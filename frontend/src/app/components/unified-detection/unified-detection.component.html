<div class="unified-detection-container">
  <div class="header">
    <h1>ğŸ¯ AI Video Analytics System</h1>
    <p class="subtitle">12 Real-time Features | Unified Detection Pipeline</p>
  </div>

  <!-- Webcam Controls -->
  <div class="webcam-section">
    <div class="video-container">
      <video #videoElement class="video-feed" autoplay playsinline></video>
      <canvas #canvasElement style="display: none;"></canvas>
      
      <div class="video-overlay" *ngIf="!webcamActive">
        <p>ğŸ“¹ Webcam Inactive</p>
      </div>
    </div>

    <div class="controls">
      <button 
        class="btn btn-primary" 
        (click)="startWebcam()" 
        [disabled]="webcamActive">
        ğŸ“¹ Start Webcam
      </button>
      <button 
        class="btn btn-danger" 
        (click)="stopWebcam()" 
        [disabled]="!webcamActive">
        â¹ï¸ Stop Webcam
      </button>
      <button 
        class="btn btn-success" 
        (click)="startDetection()" 
        [disabled]="!webcamActive || isProcessing">
        â–¶ï¸ Start Detection
      </button>
      <button 
        class="btn btn-warning" 
        (click)="stopDetection()" 
        [disabled]="!isProcessing">
        â¸ï¸ Stop Detection
      </button>
      <button 
        class="btn btn-secondary" 
        (click)="resetCounters()">
        ğŸ”„ Reset Counters
      </button>
    </div>

    <div class="system-info">
      <span class="badge badge-info">FPS: {{ fps }}</span>
      <span class="badge badge-secondary">Frames: {{ totalFramesProcessed }}</span>
      <span [class]="'badge ' + (isProcessing ? 'badge-success' : 'badge-secondary')">
        {{ isProcessing ? 'âœ“ Processing' : 'â¸ï¸ Paused' }}
      </span>
    </div>
  </div>

  <!-- Feature Toggles (12 Features) -->
  <div class="features-section">
    <h2>ğŸ›ï¸ Feature Controls</h2>
    <div class="feature-grid">
      <div class="feature-toggle">
        <input type="checkbox" id="human" [(ngModel)]="enabledFeatures.human" (change)="toggleFeature('human')">
        <label for="human">ğŸ‘¤ Human Detection</label>
      </div>
      <div class="feature-toggle">
        <input type="checkbox" id="vehicle" [(ngModel)]="enabledFeatures.vehicle" (change)="toggleFeature('vehicle')">
        <label for="vehicle">ğŸš— Vehicle Detection</label>
      </div>
      <div class="feature-toggle">
        <input type="checkbox" id="helmet" [(ngModel)]="enabledFeatures.helmet" (change)="toggleFeature('helmet')">
        <label for="helmet">â›‘ï¸ Helmet/PPE</label>
      </div>
      <div class="feature-toggle">
        <input type="checkbox" id="loitering" [(ngModel)]="enabledFeatures.loitering" (change)="toggleFeature('loitering')">
        <label for="loitering">â±ï¸ Loitering</label>
      </div>
      <div class="feature-toggle">
        <input type="checkbox" id="crowd" [(ngModel)]="enabledFeatures.crowd" (change)="toggleFeature('crowd')">
        <label for="crowd">ğŸ‘¥ Crowd Density</label>
      </div>
      <div class="feature-toggle">
        <input type="checkbox" id="box_count" [(ngModel)]="enabledFeatures.box_count" (change)="toggleFeature('box_count')">
        <label for="box_count">ğŸ“¦ Box Counting</label>
      </div>
      <div class="feature-toggle">
        <input type="checkbox" id="line_crossing" [(ngModel)]="enabledFeatures.line_crossing" (change)="toggleFeature('line_crossing')">
        <label for="line_crossing">â¡ï¸ Line Crossing</label>
      </div>
      <div class="feature-toggle">
        <input type="checkbox" id="tracking" [(ngModel)]="enabledFeatures.tracking" (change)="toggleFeature('tracking')">
        <label for="tracking">ğŸ¯ Auto Tracking</label>
      </div>
      <div class="feature-toggle">
        <input type="checkbox" id="motion" [(ngModel)]="enabledFeatures.motion" (change)="toggleFeature('motion')">
        <label for="motion">ğŸŒŠ Smart Motion</label>
      </div>
      <div class="feature-toggle">
        <input type="checkbox" id="face_detection" [(ngModel)]="enabledFeatures.face_detection" (change)="toggleFeature('face_detection')">
        <label for="face_detection">ğŸ˜Š Face Detection</label>
      </div>
      <div class="feature-toggle">
        <input type="checkbox" id="face_recognition" [(ngModel)]="enabledFeatures.face_recognition" (change)="toggleFeature('face_recognition')">
        <label for="face_recognition">ğŸ” Face Recognition</label>
      </div>
    </div>
  </div>

  <!-- Detection Results Dashboard -->
  <div class="results-section" *ngIf="detectionResult">
    <h2>ğŸ“Š Live Detection Results</h2>

    <!-- Row 1: People & Vehicles -->
    <div class="stat-grid">
      <div class="stat-card">
        <h3>ğŸ‘¤ People Count</h3>
        <p class="stat-value">{{ detectionResult.people_count }}</p>
        <small>Labour Count: {{ detectionResult.labour_count }}</small>
      </div>

      <div class="stat-card">
        <h3>ğŸš— Vehicles</h3>
        <p class="stat-value">{{ detectionResult.vehicle_count }}</p>
      </div>

      <div class="stat-card" [class.alert-card]="detectionResult.helmet_violations > 0">
        <h3>â›‘ï¸ PPE Compliance</h3>
        <p class="stat-value">{{ detectionResult.ppe_compliance_rate | number:'1.0-0' }}%</p>
        <small>Violations: {{ detectionResult.helmet_violations }}</small>
      </div>

      <div class="stat-card" [class.alert-card]="detectionResult.loitering_detected">
        <h3>â±ï¸ Loitering</h3>
        <p class="stat-value">
          <span [class]="getAlertClass('loitering')">
            {{ detectionResult.loitering_detected ? 'âš ï¸ DETECTED' : 'âœ“ OK' }}
          </span>
        </p>
        <small>Count: {{ detectionResult.loitering_count }}</small>
      </div>
    </div>

    <!-- Row 2: Crowd & Production -->
    <div class="stat-grid">
      <div class="stat-card" [class.alert-card]="detectionResult.crowd_detected">
        <h3>ğŸ‘¥ Crowd Density</h3>
        <p class="stat-value">{{ detectionResult.crowd_density | uppercase }}</p>
        <small>Area: {{ detectionResult.occupied_area * 100 | number:'1.0-0' }}%</small>
      </div>

      <div class="stat-card">
        <h3>ğŸ“¦ Box Count</h3>
        <p class="stat-value">{{ detectionResult.box_count }}</p>
      </div>

      <div class="stat-card">
        <h3>â¡ï¸ Line Crossings</h3>
        <p class="stat-value">{{ detectionResult.total_crossings }}</p>
        <small [class]="getAlertClass('motion')">
          {{ detectionResult.line_crossed ? 'âœ“ Crossed' : 'No crossing' }}
        </small>
      </div>

      <div class="stat-card">
        <h3>ğŸ¯ Tracked Objects</h3>
        <p class="stat-value">{{ detectionResult.tracked_objects }}</p>
      </div>
    </div>

    <!-- Row 3: Motion & Faces -->
    <div class="stat-grid">
      <div class="stat-card" [class.alert-card]="detectionResult.motion_detected">
        <h3>ğŸŒŠ Smart Motion</h3>
        <p class="stat-value">
          <span [class]="getAlertClass('motion')">
            {{ detectionResult.motion_detected ? 'âœ“ Detected' : 'No Motion' }}
          </span>
        </p>
        <small>Intensity: {{ detectionResult.motion_intensity * 100 | number:'1.0-0' }}%</small>
      </div>

      <div class="stat-card">
        <h3>ğŸ˜Š Faces Detected</h3>
        <p class="stat-value">{{ detectionResult.faces_detected }}</p>
      </div>

      <div class="stat-card">
        <h3>ğŸ” Recognized</h3>
        <p class="stat-value">{{ detectionResult.faces_recognized.length || 0 }}</p>
        <small *ngIf="detectionResult.faces_recognized && detectionResult.faces_recognized.length > 0">
          {{ detectionResult.faces_recognized.join(', ') }}
        </small>
      </div>

      <div class="stat-card">
        <h3>â“ Unknown Faces</h3>
        <p class="stat-value">{{ detectionResult.unknown_faces }}</p>
      </div>
    </div>

    <!-- Timestamp -->
    <div class="timestamp">
      <small>Last Updated: {{ detectionResult.timestamp | date:'medium' }}</small>
    </div>
  </div>

  <!-- No Results Message -->
  <div class="no-results" *ngIf="!detectionResult && isProcessing">
    <p>â³ Processing frames...</p>
  </div>

  <div class="no-results" *ngIf="!detectionResult && !isProcessing">
    <p>ğŸ‘† Click "Start Detection" to begin</p>
  </div>
</div>
